\documentclass[a4paper,10pt]{article}
\usepackage[french]{babel}
\usepackage[utf8]{inputenc}
\usepackage[left=2.5cm,top=2cm,right=2.5cm,nohead,nofoot]{geometry}
\usepackage{url}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{listings}

\linespread{1.1}

\usepackage{xcolor}
\usepackage{inconsolata}
\lstset{
    pad\mathcal{R}o
    basicstyle=\ttfamily\small,
    numberstyle=\footnotesize,
    numbers=left,
    backgroundcolor=\color{gray!10},
    frame=single,
    tabsize=2,
    rulecolor=\color{black!30},
    title=\lstname,
    escapeinside={\%*}{*)},
    breaklines=true,
    breakatwhitespace=true,
    framextopmargin=2pt,
    framexbottommargin=2pt,
    extendedchars=false,
    inputencoding=utf8,
    literate={à}{{\`a}}1 {è}{{\`e}}1 {é}{{\'e}}1,
}



\begin{document}

\begin{titlepage}
\begin{center}
\textbf{\textsc{UNIVERSIT\'E LIBRE DE BRUXELLES}}\\
%\textbf{\textsc{Faculté des Sciences}}\\
%\textbf{\textsc{Département d'Informatique}}
\vfill{}\vfill{}
\begin{center}{\Huge Rapport : HORECA}\end{center}{\Huge \par}
\begin{center}{\large Thomas Perale (408160)}\end{center}{\Huge \par}
\vfill{}\vfill{} \vfill{}
\begin{flushleft}{\large \textbf{INFO-H-303 Base de données}}\hfill{Esteban Zimányi, Michaël Waumans}\end{flushleft}{\large\par}
\vfill{}\vfill{}\enlargethispage{3cm}
\textbf{Année académique 2015-2016}
\end{center}
\end{titlepage}

%\begin{abstract}
%Ce rapport présente ...
%\end{abstract}


\tableofcontents

\pagebreak


\section{Diagramme entité association}
\subsection{Diagramme}
\begin{figure}[hbt]
  \includegraphics[scale=0.4]{bdd.png}
  \caption{Diagramme entité association
}
\end{figure}
\subsection{Contraintes}
Les contraintes sont les suivantes :
\begin{itemize}
  \item Le couple (Longitude, Latitude) est unique.
  \item La longitude et la latitude doivent être comris entre -180 et 180.
  \item Le nom d'utilisateur est unique.
  \item L'email d'utilisateur est unique.
  \item Pour les commentaire, le couple (IdUtilisateur, date) est unique. Donc
      un même utilisateur ne peut pas écrire deux commentaires en même temps.
  \item Pour les labels, le triplet : (Label, IdArticle, IdUtilisateur) est
      unique, ça veut dire qu'une personne ne peut pas ajouter deux fois le
      même label.
  \item Le nombre d'étoile (commentaire et hotel), doit être compris entre 1 et 5.
  \item Les ID des hotels/bars/restaurants référencent ceux de la table
      établissement, chaque établissement est soit un hotel, soit un bar, soit
      un restaurant, il ne peut pas être deux type d'établissement en même
      temps.
  \item La Date de création d'un établissement doit précéder celle de ses commentaires.
  \item La Date d'enregistrement d'un admin doit précéder celle de création d'un établissement par celui-ci.
  \item La Date d'enregistrement d'un utilisateur doit être antérieur à celle où il a écrit un commentaire.
\end{itemize}



\section{Modèle relationnel}
\subsection{Modèle}

\begin{description}
\item[] \textbf{Utilisateur}(\underline{Id}, Email, MotDePasse, DateEnregistrement, Admin(0, 1))
    \begin{description}
        \item[] Utilisateur.Admin indique si l'utilisateur est un admin ou non.
    \end{description}

\item[] \textbf{Etablissement}(\underline{Id}, Nom, Adresse.Rue,
    Adresse.Numéro, Adresse.CodePostal, Adresse.Localité, Coordonnée.Latitude,
    Coordonnée.Longitude, Téléphone, Site, DateCreation, Creator)
    \begin{description}
        \item[] Etablissement.Creator réfèrence Utilisateur.Id.
    \end{description}

\item[] \textbf{Restaurant}(\underline{Id}, Prix, Places, AEmporter, Livraison, horaire)
    \begin{description}
        \item[] Restaurant.Id réfèrence Etablissement.Id.
    \end{description}

\item[] \textbf{Bar}(\underline{Id}, Fumeur, Snacks)
    \begin{description}
        \item[] Bar.Id réfèrence Etablissement.Id.
    \end{description}

\item[] \textbf{Hotel}(\underline{Id}, NombreEtoile, NombreChambre, Prix)
    \begin{description}
        \item[] Hotel.Id réfèrence Etablissement.Id.
    \end{description}

\item[] \textbf{Commentaire}(\underline{Id}, Commentaire, NombreEtoile, Date,
    Image, IdArticle, IdUtilisateur)
    \begin{description}
        \item[] Commentaire.IdArticle réfèrence Etablissement.Id.
        \item[] Commentaire.IdUtilisateur réfèrence Utilisateur.Id.
    \end{description}

\item[] \textbf{Label}(\underline{Id}, Label, IdArticle, IdUtilisateur)
    \begin{description}
        \item[] Commentaire.IdArticle réfèrence Etablissement.Id.
        \item[] Commentaire.IdUtilisateur réfèrence Utilisateur.Id.
    \end{description}
\end{description}

\subsection{Contraintes}

\begin{itemize}
    \item On doit d'abord créer l'établissement avant de créer sa
        spécialisation (restaurant, bar, hotel) de manière à pouvoir
        référencer cet établissement.
\end{itemize}

\section{Hypothèses}
Les utilisateur "admin" sont encodé directement dans la base de donnée.
\newline

Il est marqué dans l'énoncé :
\begin{quote}
    Les utilisateurs peuvent commenter plusieurs fois le même
    établissement à des dates différentes.
\end{quote}
Les dates seront stocké dans ma base de donnée sous forme de \emph{timestamp},
dés lors un utilisateur ne pourra pas envoyer deux message lors de la même seconde.
\newline

Un administrateur peut modifier un établissement, mais j'ai décidé de ne pas
stocker les dates de modification mais seulement celle de création.
\newline

Les adresses mails ainsi que les mot de passes des \emph{Utilisateur} qui nous
sont fournis dans le fichier \emph{Data.zip} peuvent être choisis.

\section{Justification}

J'ai décidé pour la généralisation des établissements d'hériter les clées
principales qui sont dans établissement. De cette manière j'évite de devoir
redéclarer à chaque fois dans chaques table spécialisée (hotel, restaurant ou
bar) les mêmes données. De plus la recherche de d'établissement par nom est
rendue plus simple. \newline

Pour le généralistion des utilisateurs j'ai décidé d'ajouter une colonne
"Admin" dans la table utilisateur pour permettre de savoir si un utilisateur
est admin ou non. \newline

En ce qui concerne les \emph{labels} j'ai décidé de mettre l'\emph{ID} de
l'utilisateur dans une des colonnes, de cette façon on sait facilement savoir
si une personne a déjà ajouté un certain label ou non.

\section{Script SQL DDL}
    \lstinputlisting[language=SQL]{../db/create.sql}

    \pagebreak

\section{Requêtes}
\subsection{Tous les Utilisateurs qui apprécient au moins 3 établissements que
l'utilisateur \emph{Brenda} apprécie.}
    \lstinputlisting[language=SQL]{../db/1.sql}

\subsection{Tous les établissements qu'apprécie au moins un utilisateur qui
apprécie tous les établissements que \emph{Brenda} apprécie.}
    \lstinputlisting[language=SQL]{../db/2.sql}

\subsection{Tous les établissements pour lesquels il y a au plus un
commentaire.}
    \lstinputlisting[language=SQL]{../db/3.sql}

\subsection{La liste des administrateurs n'ayant pas commenté tous les
établissements qu'ils ont crées.}
    \lstinputlisting[language=SQL]{../db/4.sql}

\subsection{La liste des établissements ayant au minimum trois commentaires,
classée selon la moyenne des scores attribués.}
    \lstinputlisting[language=SQL]{../db/5.sql}

\subsection{La liste des labels étant appliqués à au moins 5 établissements,
classée selon la moyenne des scores des établissements ayant ce label.}
    \lstinputlisting[language=SQL]{../db/6.sql}

\section{Implémentation}
\section{Language et libraires}
\begin{itemize}
    \item \emph{Express.js} comme frameword web pour le language \emph{node.js}.
    \item \emph{Handlebars.js} comme moteur de template pour \emph{express.js}.
    \item \emph{Bootstrap} et \emph{jQuery} comme framework de frontend.
    \item \emph{SQLite3} comme moteur de base de donnée.
\end{itemize}
\section{Script d'insértion de données}
    \lstinputlisting[language=python]{../init.py}
    \pagebreak

\section{}

\section{Apports personnels}
\subsection{Site adapté aux téléphones mobiles}

\subsection{Gestion des privilèges}

\subsection{Localisation des restaurants sur une carte}
    Afin de permettre de pouvoir directement voir l'emplacement des
    établissements sur une l'application intêgre des cartes pour visualiser
    l'emplacement de l'établissement \emph{HORECA}. Celles-ci sont intégrées à
    la page web à l'aide d'une bibliothèque Javascript, Leaflet.
    En plus de montrer l'emplacement sur une carte celles-ci montre aussi un
    rapide aperçu des caractéristiques de l'établissement.

    % include image de l'enroule.

\subsection{Géolocalisation sur la carte}
    En plus de montrer la localisation des restaurants, l'application permet
    de pouvoir se géolocaliser sur la carte, par apport aux établissements.
    \newline
    Cette fonctionnalitée est d'autant plus la bienvenue que l'application est
    adaptée aux téléphones mobiles.

\subsection{Gestion des photos}
    L'application gère le stockage d'image dans la base de donnée.
    Chaques utilisateur inscrit sur le site peuvent dés lors écrire un
    commentaire dans la section adaptée accompagné d'une photo de
    l'établissement visité par exemple. \newline
    Quant aux utilisateurs dit \emph{administrateur}, ils peuvent modifier
    la photo de l'établissement pour que chaques visiteur aie un aperçu de
    l'apparence de l'établissement. \newline
    De plus la gestion de ces photos permet de les visionner de manière
    comfortable à l'aide du module enhance.js. En effet celui-ci permet de voir
    une photo \emph{en grand}, sans devoir changer de page.

    % insert picture of upload and look and enhance.js.

\subsection{Recherche de label similaire.}
    Pour permettre aux visiteurs de trouver des établissements avec des
    contraintes spécifiques, l'application lie tout les labels de chaques
    établissements. Un visiteurs peut dés lors retrouver tout les
    établissements qui possède le label de son choix, par exemple
    \emph{Fumeur}.

\subsection{Vote dans les commentaires}
    Un système de vote individuel à chaques commentaire est mit en place pour
    que chaque utilisateur inscript aie le droit de juger des commentaires
    qui selon lui ne sont pas raisonnable ou inversément.
\end{document}
